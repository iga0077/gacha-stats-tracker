<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Gacha Stats Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: auto;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: rgba(20, 20, 40, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #333;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            gap: 20px;
        }

        .header-left {
            display: flex;
            align-items: center;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .header-control {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-control label {
            color: #4a90e2;
            font-weight: bold;
            font-size: 12px;
            white-space: nowrap;
        }

        .header-control select {
            background: rgba(30, 30, 50, 0.8);
            color: #e0e0e0;
            border: 1px solid #4a90e2;
            padding: 6px 8px;
            border-radius: 6px;
            font-size: 12px;
            min-width: 100px;
        }

        .settings-btn {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.4);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: rgba(15, 15, 30, 0.95);
            backdrop-filter: blur(10px);
            transition: left 0.3s ease;
            z-index: 1001;
            padding: 20px;
            border-right: 1px solid #333;
            overflow-y: auto;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar h3 {
            color: #4a90e2;
            margin-bottom: 20px;
            padding-top: 40px;
        }

        .sidebar-btn {
            width: 100%;
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            border: none;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
        }

        .sidebar-btn:hover {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            transform: translateX(5px);
        }

        .sidebar-btn.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .sidebar-btn.danger:hover {
            background: linear-gradient(45deg, #c0392b, #e74c3c);
        }

        .sidebar-btn.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .sidebar-btn.success:hover {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .main-content {
            margin-top: 80px;
            padding: 20px;
            min-height: calc(100vh - 80px);
        }

        .stats-container {
            display: grid;
            gap: 30px;
        }

        .stats-container.one-game {
            grid-template-columns: 1fr;
        }

        .stats-container.two-games {
            grid-template-columns: repeat(2, 1fr);
        }

        .stats-container.three-games {
            grid-template-columns: repeat(3, 1fr);
        }

        .game-stats {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
        }

        .game-title {
            font-size: 24px;
            color: #4a90e2;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            position: relative;
        }

        .game-title-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .game-title-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .game-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .game-title:hover .game-actions {
            opacity: 1;
        }

        .game-action-btn {
            background: rgba(74, 144, 226, 0.7);
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .game-action-btn:hover {
            background: rgba(74, 144, 226, 1);
            transform: translateY(-1px);
        }

        .game-action-btn.delete {
            background: rgba(231, 76, 60, 0.7);
        }

        .game-action-btn.delete:hover {
            background: rgba(231, 76, 60, 1);
        }

        .overall-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 30, 50, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #444;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #4a90e2;
        }

        .stat-label {
            color: #aaa;
            font-size: 12px;
            margin-top: 5px;
        }

        .banners-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
        }

        .banner {
            background: rgba(25, 25, 45, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #444;
        }

        .banner-title {
            font-size: 18px;
            color: #4a90e2;
            margin-bottom: 15px;
            text-align: center;
        }

        .banner-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .banner-stat {
            background: rgba(40, 40, 60, 0.8);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            font-size: 11px;
        }

        .add-pull-btn {
            width: 100%;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .add-pull-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .pulls-list {
            min-height: 50px;
        }

        .pull-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(40, 40, 60, 0.6);
            position: relative;
            transition: all 0.3s ease;
        }

        .pull-item:hover {
            background: rgba(50, 50, 70, 0.8);
        }

        .pull-item:hover .pull-actions {
            opacity: 1;
            width: auto;
            margin-left: 10px;
        }

        .pull-number {
            font-weight: bold;
            color: #666;
            margin-right: 10px;
            min-width: 25px;
        }

        .pull-name {
            flex: 1;
            font-weight: bold;
            margin-left: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pull-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .pull-action-btn {
            background: rgba(74, 144, 226, 0.7);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.3s ease;
        }

        .pull-action-btn:hover {
            background: rgba(74, 144, 226, 1);
        }

        .pull-action-btn.delete {
            background: rgba(231, 76, 60, 0.7);
        }

        .pull-action-btn.delete:hover {
            background: rgba(231, 76, 60, 1);
        }

        .pull-count {
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            min-width: 40px;
            text-align: center;
        }

        .pull-type {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }

        .character { color: #ffa500; }
        .weapon { color: #4a90e2; }
        .win { background: #27ae60; color: white; }
        .lose { background: #e74c3c; color: white; }
        .guarantee { background: #f39c12; color: white; }

        .good { background: #27ae60; }
        .average { background: #f39c12; }
        .bad { background: #e74c3c; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —É–¥–∞—á–∏ */
        .luck-score {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            background: transparent;
        }

        .luck-score-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .luck-score.excellent .luck-score-circle {
            background: #27ae60;
        }

        .luck-score.good .luck-score-circle {
            background: #2ecc71;
        }

        .luck-score.average .luck-score-circle {
            background: #f39c12;
        }

        .luck-score.bad .luck-score-circle {
            background: #e74c3c;
        }

        .luck-score-text {
            font-size: 14px;
            font-weight: bold;
        }

        .luck-score.excellent .luck-score-text {
            color: #27ae60;
        }

        .luck-score.good .luck-score-text {
            color: #2ecc71;
        }

        .luck-score.average .luck-score-text {
            color: #f39c12;
        }

        .luck-score.bad .luck-score-text {
            color: #e74c3c;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(20, 20, 40, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #444;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal h3 {
            color: #4a90e2;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        .form-group input, .form-group select {
            width: 100%;
            background: rgba(30, 30, 50, 0.8);
            color: #e0e0e0;
            border: 1px solid #4a90e2;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c757d, #545b62);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        .banner-setup {
            margin-bottom: 20px;
        }

        .banner-setup h4 {
            color: #4a90e2;
            margin-bottom: 15px;
        }

        .banner-config {
            background: rgba(30, 30, 50, 0.6);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .banner-config-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .banner-config-header input[type="checkbox"] {
            width: auto;
        }

        .guarantee-input {
            margin-top: 10px;
        }

        .no-games {
            text-align: center;
            color: #aaa;
            font-size: 18px;
            margin-top: 50px;
        }

        .comparison-view {
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .comparison-title {
            font-size: 28px;
            color: #4a90e2;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }

        .comparison-games {
            display: grid;
            gap: 30px;
        }

        .comparison-games.one-game {
            grid-template-columns: 1fr;
        }

        .comparison-games.two-games {
            grid-template-columns: repeat(2, 1fr);
        }

        .comparison-games.three-games {
            grid-template-columns: repeat(3, 1fr);
        }

        .comparison-game {
            background: rgba(20, 20, 40, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
            position: relative;
        }

        .comparison-game-title {
            font-size: 24px;
            color: #4a90e2;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .comparison-luck-score {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
            justify-content: center;
            background: transparent;
        }

        .comparison-luck-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .comparison-luck-score.excellent .comparison-luck-circle {
            background: #27ae60;
        }

        .comparison-luck-score.good .comparison-luck-circle {
            background: #2ecc71;
        }

        .comparison-luck-score.average .comparison-luck-circle {
            background: #f39c12;
        }

        .comparison-luck-score.bad .comparison-luck-circle {
            background: #e74c3c;
        }

        .comparison-luck-text {
            font-size: 14px;
            font-weight: bold;
        }

        .comparison-luck-score.excellent .comparison-luck-text {
            color: #27ae60;
        }

        .comparison-luck-score.good .comparison-luck-text {
            color: #2ecc71;
        }

        .comparison-luck-score.average .comparison-luck-text {
            color: #f39c12;
        }

        .comparison-luck-score.bad .comparison-luck-text {
            color: #e74c3c;
        }

        .comparison-overall-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .comparison-stat-card {
            background: rgba(30, 30, 50, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #444;
            position: relative;
        }

        .comparison-stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 5px;
        }

        .comparison-stat-label {
            color: #aaa;
            font-size: 12px;
        }

        .comparison-stat-card.best {
            background: rgba(39, 174, 96, 0.3) !important;
            border: 1px solid #2ecc71;
        }

        .comparison-stat-card.best .comparison-stat-value {
            color: #2ecc71;
        }

        .comparison-stat-card.worst {
            background: rgba(231, 76, 60, 0.3) !important;
            border: 1px solid #e74c3c;
        }

        .comparison-stat-card.worst .comparison-stat-value {
            color: #e74c3c;
        }

        .comparison-summary {
            background: rgba(25, 25, 45, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #444;
        }

        .comparison-summary-title {
            font-size: 18px;
            color: #4a90e2;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .comparison-summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .comparison-summary-stat {
            background: rgba(40, 40, 60, 0.8);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .comparison-summary-value {
            font-size: 16px;
            font-weight: bold;
            color: #4a90e2;
            margin-bottom: 5px;
        }

        .comparison-summary-label {
            color: #aaa;
            font-size: 11px;
        }

        @media (max-width: 1200px) {
            .stats-container.three-games {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .stats-container.two-games,
            .stats-container.three-games {
                grid-template-columns: 1fr;
            }
            
            .overall-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .banners-container {
                grid-template-columns: 1fr;
            }

            .header-controls {
                display: none;
            }

            .header {
                justify-content: space-between;
            }

            .header-right {
                gap: 10px;
            }

            .user-name {
                display: none;
            }

            .comparison-games.two-games,
            .comparison-games.three-games {
                grid-template-columns: 1fr;
            }

            .comparison-overall-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .comparison-summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .luck-score {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            .luck-score-value {
                font-size: 24px;
            }
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ */
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .auth-container {
            background: rgba(20, 20, 40, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 1px solid #333;
            max-width: 400px;
            width: 90%;
        }

        .auth-container h1 {
            color: #4a90e2;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .auth-container p {
            color: #aaa;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background: white;
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }

        .google-signin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .google-signin-btn img {
            width: 20px;
            height: 20px;
        }

        .app-content {
            min-height: 100vh;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid #4a90e2;
        }

        .user-name {
            color: #e0e0e0;
            font-size: 14px;
            font-weight: bold;
        }

        .signout-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .signout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.4);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∏–≥—Ä */
        .preset-games {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .preset-game-btn {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .preset-game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .global-stats-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-right: 15px;
        }

        .global-stats-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.4);
        }

        .global-stats-btn.my-stats {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .global-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .global-tab {
            background: rgba(74, 144, 226, 0.1);
            color: #4a90e2;
            border: 1px solid #4a90e2;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .global-tab:hover {
            background: rgba(74, 144, 226, 0.2);
        }

        .global-tab.active {
            background: #4a90e2;
            color: white;
        }

        .users-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .user-card {
            background: rgba(20, 20, 40, 0.8);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
            border-color: #4a90e2;
        }

        .user-card .user-avatar {
            width: 48px;
            height: 48px;
        }

        .user-card .user-info h3 {
            margin: 0 0 5px 0;
            color: #e0e0e0;
        }

        .user-card .user-info p {
            margin: 0;
            color: #aaa;
            font-size: 14px;
        }

        .selected-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(20, 20, 40, 0.9);
            border: 1px solid #4a90e2;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .selected-user-info .user-avatar {
            width: 40px;
            height: 40px;
        }

        .selected-user-info h2 {
            margin: 0;
            color: #e0e0e0;
        }

        .game-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .comparison-card {
            background: rgba(20, 20, 40, 0.8);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .comparison-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }

        .comparison-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .comparison-header .user-avatar {
            width: 32px;
            height: 32px;
        }

        .comparison-header h3 {
            margin: 0;
            color: #e0e0e0;
        }

        .comparison-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-label {
            color: #aaa;
            font-size: 14px;
        }

        .stat-value {
            color: #e0e0e0;
            font-weight: bold;
            font-size: 14px;
        }

        .no-data {
            text-align: center;
            color: #aaa;
            font-size: 16px;
            padding: 40px;
        }

        .show-all-container {
            text-align: center;
            margin-top: 20px;
        }

        .show-all-btn {
            background: linear-gradient(45deg, #4a90e2, #357abd);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .show-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
        }

        @media (max-width: 768px) {
            .global-tabs {
                flex-direction: column;
                align-items: center;
            }

            .users-list {
                grid-template-columns: 1fr;
                padding: 10px;
            }

            .game-comparison {
                grid-template-columns: 1fr;
                padding: 10px;
            }

            .global-stats-btn {
                margin-right: 10px;
                font-size: 11px;
                padding: 6px 12px;
            }
        }
    </style>
	<!-- Firebase SDK -->
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
	<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-container">
            <h1>üéÆ Gacha Stats Tracker</h1>
            <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤–∞—à–∏—Ö –≥–∞—á–∞ –∏–≥—Ä</p>
            <button id="googleSignInBtn" class="google-signin-btn">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google">
                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="appContent" class="app-content" style="display: none;">
        <div class="header">
            <div class="header-left">
                <button class="settings-btn" onclick="toggleSidebar()">‚öôÔ∏è</button>
            </div>
            <div class="header-controls">
                <div class="header-control">
                    <label for="viewMode">–†–µ–∂–∏–º:</label>
                    <select id="viewMode" onchange="updateViewMode()">
                        <option value="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</option>
                        <option value="comparison">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</option>
                    </select>
                </div>
                <div class="header-control" id="gameCountControl">
                    <label for="gameCount">–ò–≥—Ä:</label>
                    <select id="gameCount" onchange="updateStats()">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                    </select>
                </div>
                <div class="header-control" id="gameSelectControl1">
                    <label for="gameSelect1">–ò–≥—Ä–∞ 1:</label>
                    <select id="gameSelect1" onchange="updateStats()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</option>
                    </select>
                </div>
                <div class="header-control" id="gameSelectControl2" style="display: none;">
                    <label for="gameSelect2">–ò–≥—Ä–∞ 2:</label>
                    <select id="gameSelect2" onchange="updateStats()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</option>
                    </select>
                </div>
                <div class="header-control" id="gameSelectControl3" style="display: none;">
                    <label for="gameSelect3">–ò–≥—Ä–∞ 3:</label>
                    <select id="gameSelect3" onchange="updateStats()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</option>
                    </select>
                </div>
            </div>
            <div class="header-right">
                <button id="globalStatsBtn" class="global-stats-btn" onclick="toggleGlobalStats()">–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <div class="user-info">
                    <img id="userAvatar" class="user-avatar" src="" alt="Avatar">
                    <span id="userName" class="user-name"></span>
                </div>
                <button class="signout-btn" onclick="signOut()">–í—ã–π—Ç–∏</button>
            </div>
        </div>

    <div class="sidebar" id="sidebar">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏</h3>
        <button class="sidebar-btn" onclick="openAddGameModal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É</button>
        <button class="sidebar-btn danger" onclick="clearAllData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        
        <h3>–î–∞–Ω–Ω—ã–µ</h3>
        <button class="sidebar-btn success" onclick="exportData()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
        <label for="importFile" class="file-input-label">üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</label>
        <input type="file" id="importFile" class="file-input" accept=".json" onchange="importData(event)">
    </div>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

    <div class="main-content">
        <div id="statsContainer" class="stats-container one-game">
            <div class="no-games">
                <p>–î–æ–±–∞–≤—å—Ç–µ –∏–≥—Ä—É —á–µ—Ä–µ–∑ ‚öôÔ∏è –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="addGameModal" class="modal">
        <div class="modal-content">
            <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</h3>
            <div class="preset-games">
                <button type="button" class="preset-game-btn" onclick="selectPresetGame('Zenless Zone Zero')">ZZZ</button>
                <button type="button" class="preset-game-btn" onclick="selectPresetGame('Girls\' Frontline 2')">GFL2</button>
                <button type="button" class="preset-game-btn" onclick="selectPresetGame('Genshin Impact')">Genshin</button>
            </div>
            <div class="form-group">
                <label for="gameName">–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã:</label>
                <input type="text" id="gameName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã">
            </div>
            
            <div class="banner-setup">
                <h4>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–Ω–Ω–µ—Ä–æ–≤</h4>
                
                <div class="banner-config">
                    <div class="banner-config-header">
                        <input type="checkbox" id="standardBanner" checked>
                        <label for="standardBanner">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</label>
                    </div>
                    <div class="guarantee-input">
                        <label for="standardGuarantee">–ì–∞—Ä–∞–Ω—Ç:</label>
                        <select id="standardGuarantee">
                            <option value="90">90</option>
                            <option value="80">80</option>
                            <option value="70">70</option>
                            <option value="custom">–î—Ä—É–≥–æ–π</option>
                        </select>
                        <input type="number" id="standardCustom" style="display: none; margin-top: 5px;" min="1" max="200" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                    </div>
                </div>

                <div class="banner-config">
                    <div class="banner-config-header">
                        <input type="checkbox" id="eventBanner" checked>
                        <label for="eventBanner">–ò–≤–µ–Ω—Ç–æ–≤—ã–π –±–∞–Ω–Ω–µ—Ä</label>
                    </div>
                    <div class="guarantee-input">
                        <label for="eventGuarantee">–ì–∞—Ä–∞–Ω—Ç:</label>
                        <select id="eventGuarantee">
                            <option value="90">90</option>
                            <option value="80">80</option>
                            <option value="70">70</option>
                            <option value="custom">–î—Ä—É–≥–æ–π</option>
                        </select>
                        <input type="number" id="eventCustom" style="display: none; margin-top: 5px;" min="1" max="200" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                    </div>
                </div>

                <div class="banner-config">
                    <div class="banner-config-header">
                        <input type="checkbox" id="weaponBanner" checked>
                        <label for="weaponBanner">–û—Ä—É–∂–µ–π–Ω—ã–π –±–∞–Ω–Ω–µ—Ä</label>
                    </div>
                    <div class="guarantee-input">
                        <label for="weaponGuarantee">–ì–∞—Ä–∞–Ω—Ç:</label>
                        <select id="weaponGuarantee">
                            <option value="80">80</option>
                            <option value="90">90</option>
                            <option value="70">70</option>
                            <option value="custom">–î—Ä—É–≥–æ–π</option>
                        </select>
                        <input type="number" id="weaponCustom" style="display: none; margin-top: 5px;" min="1" max="200" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ">
                    </div>
                </div>
            </div>

            <div class="form-buttons">
                <button class="btn btn-secondary" onclick="closeAddGameModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="addGame()">–î–æ–±–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="addPullModal" class="modal">
        <div class="modal-content">
            <h3 id="addPullTitle">–î–æ–±–∞–≤–∏—Ç—å –∫—Ä—É—Ç–∫—É</h3>
            <div class="form-group">
                <label for="pullName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞/–æ—Ä—É–∂–∏—è:</label>
                <input type="text" id="pullName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            </div>
            <div class="form-group">
                <label for="pullCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É—Ç–æ–∫:</label>
                <input type="number" id="pullCount" min="1" max="200" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">
            </div>
            <div class="form-group" id="pullTypeGroup">
                <label for="pullType">–¢–∏–ø:</label>
                <select id="pullType">
                    <option value="character">–ü–µ—Ä—Å–æ–Ω–∞–∂</option>
                    <option value="weapon">–û—Ä—É–∂–∏–µ</option>
                </select>
            </div>
            <div class="form-group" id="eventResultGroup" style="display: none;">
                <label for="eventResult">–†–µ–∑—É–ª—å—Ç–∞—Ç:</label>
                <select id="eventResult">
                    <option value="win">–ü–æ–±–µ–¥–∞ (W)</option>
                    <option value="lose">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ (L)</option>
                    <option value="guarantee">–ì–∞—Ä–∞–Ω—Ç (G)</option>
                </select>
            </div>
            <div class="form-buttons">
                <button class="btn btn-secondary" onclick="closeAddPullModal()">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" onclick="savePull()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    </div>

    <script>
        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const firebaseConfig = {
            apiKey: "AIzaSyBrlOVpLyaQC-j35jKI6dpUROeJ4Q2dXaU",
            authDomain: "igatrackers.firebaseapp.com",
            projectId: "igatrackers",
            storageBucket: "igatrackers.firebasestorage.app",
            messagingSenderId: "629727578641",
            appId: "1:629727578641:web:c85bd10081c56e0e283fb0",
            measurementId: "G-MZ6W6B5MTX"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let games = [];
        let currentGameIds = [null, null, null];
        let currentBannerType = null;
        let editingPullIndex = -1;
        let currentUser = null;

        // –§—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            });
        }

        function signOut() {
            auth.signOut().then(() => {
                showAuthScreen();
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
            });
        }

        function showAuthScreen() {
            document.getElementById('authScreen').style.display = 'flex';
            document.getElementById('appContent').style.display = 'none';
        }

        function showAppContent() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('appContent').style.display = 'block';
        }

        function updateUserInfo(user) {
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            
            if (user && user.photoURL) {
                userAvatar.src = user.photoURL;
            } else {
                userAvatar.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K';
            }
            
            if (user && user.displayName) {
                userName.textContent = user.displayName;
            } else {
                userName.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        }

        // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        auth.onAuthStateChanged(async function(user) {
            currentUser = user;
            
            if (user) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                showAppContent();
                updateUserInfo(user);
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                await loadUserData();
                const savedSettings = await loadInterfaceSettings();
                updateGameSelectors();
                setupGuaranteeHandlers();
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                if (savedSettings) {
                    updateViewMode();
                }
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                showAuthScreen();
                games = [];
                currentGameIds = [null, null, null];
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –∏–≥—Ä—ã
        function selectPresetGame(gameName) {
            document.getElementById('gameName').value = gameName;
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        let isGlobalStatsMode = false;
        let allUsersData = [];
        let currentGlobalView = 'users'; // 'users', 'zzz', 'gfl2', 'genshin'
        let selectedUser = null;

        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function toggleGlobalStats() {
            if (isGlobalStatsMode) {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–≤–æ–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
                isGlobalStatsMode = false;
                selectedUser = null;
                document.getElementById('globalStatsBtn').textContent = '–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞';
                document.getElementById('globalStatsBtn').classList.remove('my-stats');
                showMyStats();
            } else {
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ
                isGlobalStatsMode = true;
                document.getElementById('globalStatsBtn').textContent = '–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞';
                document.getElementById('globalStatsBtn').classList.add('my-stats');
                loadGlobalStats();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadGlobalStats() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏
                const usersSnapshot = await db.collection('gacha').get();
                allUsersData = [];
                
                for (const doc of usersSnapshot.docs) {
                    const userData = doc.data();
                    if (userData.games && userData.games.length > 0) {
                        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ gacha –∫–æ–ª–ª–µ–∫—Ü–∏–∏
                        allUsersData.push({
                            uid: doc.id,
                            games: userData.games,
                            displayName: userData.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                            photoURL: userData.photoURL || null,
                            email: userData.email || ''
                        });
                    }
                }
                
                showGlobalStats();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function showGlobalStats() {
            const container = document.getElementById('container');
            container.innerHTML = '';
            
            if (selectedUser) {
                showUserStats(selectedUser);
            } else {
                showGlobalUsersList();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showGlobalUsersList() {
            const container = document.getElementById('container');
            
            // –°–∫—Ä—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.querySelector('.header-controls').style.display = 'none';
            
            // –°–æ–∑–¥–∞–µ–º –≤–∫–ª–∞–¥–∫–∏
            const tabsHtml = `
                <div class="global-tabs">
                    <button class="global-tab active" onclick="switchGlobalTab('users')">–í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
                    <button class="global-tab" onclick="switchGlobalTab('zzz')">Zenless Zone Zero</button>
                    <button class="global-tab" onclick="switchGlobalTab('gfl2')">Girls' Frontline 2</button>
                    <button class="global-tab" onclick="switchGlobalTab('genshin')">Genshin Impact</button>
                </div>
            `;
            
            container.innerHTML = tabsHtml + '<div id="globalContent"></div>';
            
            switchGlobalTab('users');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function switchGlobalTab(tab) {
            currentGlobalView = tab;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.global-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (tab === 'users') {
                showUsersList();
            } else {
                showGameComparison(tab);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showUsersList() {
            const content = document.getElementById('globalContent');
            
            let html = '<div class="users-list">';
            
            const usersToShow = allUsersData.slice(0, 20);
            
            usersToShow.forEach(user => {
                html += `
                    <div class="user-card" onclick="selectUser('${user.uid}')">
                        <img src="${user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K'}" alt="Avatar" class="user-avatar">
                        <div class="user-info">
                            <h3>${user.displayName}</h3>
                            <p>${user.games.length} –∏–≥—Ä</p>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ" –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–µ 20
            if (allUsersData.length > 20) {
                html += `
                    <div class="show-all-container">
                        <button class="show-all-btn" onclick="showAllUsers()">
                            –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ (${allUsersData.length})
                        </button>
                    </div>
                `;
            }
            
            content.innerHTML = html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function showAllUsers() {
            const content = document.getElementById('globalContent');
            
            let html = '<div class="users-list">';
            
            allUsersData.forEach(user => {
                html += `
                    <div class="user-card" onclick="selectUser('${user.uid}')">
                        <img src="${user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K'}" alt="Avatar" class="user-avatar">
                        <div class="user-info">
                            <h3>${user.displayName}</h3>
                            <p>${user.games.length} –∏–≥—Ä</p>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // –í—ã–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function selectUser(uid) {
            selectedUser = allUsersData.find(user => user.uid === uid);
            showUserStats(selectedUser);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function showUserStats(user) {
            const container = document.getElementById('container');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.querySelector('.header-controls').style.display = 'flex';
            
            // –í—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const originalGames = games;
            games = user.games;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏–≥—Ä
            updateGameSelectors();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
            games = originalGames;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å–≤–µ—Ä—Ö—É
            const userInfoHtml = `
                <div class="selected-user-info">
                    <img src="${user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K'}" alt="Avatar" class="user-avatar">
                    <h2>${user.displayName}</h2>
                </div>
            `;
            
            container.insertAdjacentHTML('afterbegin', userInfoHtml);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ –∏–≥—Ä–µ
        function showGameComparison(gameType) {
            const content = document.getElementById('globalContent');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ —ç—Ç–æ–π –∏–≥—Ä–µ
            const gameName = {
                'zzz': 'Zenless Zone Zero',
                'gfl2': 'Girls\' Frontline 2',
                'genshin': 'Genshin Impact'
            }[gameType];
            
            const usersWithGame = allUsersData.filter(user => 
                user.games.some(game => game.name === gameName)
            );
            
            if (usersWithGame.length === 0) {
                content.innerHTML = '<p class="no-data">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —ç—Ç–æ–π –∏–≥—Ä–µ</p>';
                return;
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∫—Ä—É—Ç–æ–∫
            usersWithGame.sort((a, b) => {
                const gameA = a.games.find(g => g.name === gameName);
                const gameB = b.games.find(g => g.name === gameName);
                const totalA = gameA ? gameA.banners.reduce((sum, b) => sum + b.pulls.length, 0) : 0;
                const totalB = gameB ? gameB.banners.reduce((sum, b) => sum + b.pulls.length, 0) : 0;
                return totalB - totalA; // –û—Ç –±–æ–ª—å—à–µ–≥–æ –∫ –º–µ–Ω—å—à–µ–º—É
            });
            
            let html = '<div class="game-comparison">';
            
            usersWithGame.forEach((user, index) => {
                const game = user.games.find(g => g.name === gameName);
                if (!game) return;
                
                const totalPulls = game.banners.reduce((sum, b) => sum + b.pulls.length, 0);
                const legendaryPulls = game.banners.reduce((sum, b) => 
                    sum + b.pulls.filter(p => p.type === 'character' || p.type === 'weapon').length, 0
                );
                const avgLegendary = legendaryPulls > 0 ? (totalPulls / legendaryPulls).toFixed(1) : 0;
                
                const trophy = index < 3 ? ['üèÜ', 'ü•à', 'ü•â'][index] : '';
                
                html += `
                    <div class="comparison-card">
                        <div class="comparison-header">
                            ${trophy} <img src="${user.photoURL || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM0YTkwZTIiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0id2hpdGUiPgo8cGF0aCBkPSJNMTIgMTJjMi4yMSAwIDQtMS43OSA0LTRzLTEuNzktNC00LTQtNCAxLjc5LTQgNCAxLjc5IDQgNCA0em0wIDJjLTIuNjcgMC04IDEuMzQtOCA0djJoMTZ2LTJjMC0yLjY2LTUuMzMtNC04LTR6Ii8+Cjwvc3ZnPgo8L3N2Zz4K'}" alt="Avatar" class="user-avatar">
                            <h3>${user.displayName}</h3>
                        </div>
                        <div class="comparison-stats">
                            <div class="stat-item">
                                <span class="stat-label">–í—Å–µ–≥–æ –∫—Ä—É—Ç–æ–∫:</span>
                                <span class="stat-value">${totalPulls}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–õ–µ–≥–µ–Ω–¥–∞—Ä–æ–∫:</span>
                                <span class="stat-value">${legendaryPulls}</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">–°—Ä–µ–¥–Ω—è—è –ª–µ–≥–∞:</span>
                                <span class="stat-value">${avgLegendary}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            content.innerHTML = html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function showMyStats() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            document.querySelector('.header-controls').style.display = 'flex';
            
            // –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            const selectedUserInfo = document.querySelector('.selected-user-info');
            if (selectedUserInfo) {
                selectedUserInfo.remove();
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏–≥—Ä
            updateGameSelectors();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            updateStats();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        window.onload = function() {
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –≤—Ö–æ–¥–∞
            document.getElementById('googleSignInBtn').addEventListener('click', signInWithGoogle);
        };

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–æ–≤
        function setupGuaranteeHandlers() {
            ['standard', 'event', 'weapon'].forEach(type => {
                const select = document.getElementById(type + 'Guarantee');
                const customInput = document.getElementById(type + 'Custom');
                
                select.onchange = function() {
                    if (this.value === 'custom') {
                        customInput.style.display = 'block';
                    } else {
                        customInput.style.display = 'none';
                    }
                };
            });
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π–¥–±–∞—Ä–æ–º
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('show');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('show');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                const doc = await db.collection('gacha').doc(currentUser.uid).get();
                if (doc.exists) {
                    games = doc.data().games || [];
                    console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Firebase');
                } else {
                    games = [];
                    console.log('–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Å–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
                games = [];
            }
        }

        async function saveData() {
            if (!currentUser) return;
            
            try {
                await db.collection('gacha').doc(currentUser.uid).set({
                    games: games,
                    displayName: currentUser.displayName || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                    photoURL: currentUser.photoURL || null,
                    email: currentUser.email || '',
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function saveInterfaceSettings() {
            const settings = {
                viewMode: document.getElementById('viewMode').value,
                gameCount: document.getElementById('gameCount').value,
                selectedGames: [
                    document.getElementById('gameSelect1').value,
                    document.getElementById('gameSelect2').value,
                    document.getElementById('gameSelect3').value
                ]
            };
            localStorage.setItem('gachaInterfaceSettings', JSON.stringify(settings));
        }

        function loadInterfaceSettings() {
            const savedSettings = localStorage.getItem('gachaInterfaceSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä
                document.getElementById('viewMode').value = settings.viewMode || 'stats';
                document.getElementById('gameCount').value = settings.gameCount || '1';
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
                currentGameIds = settings.selectedGames || [null, null, null];
                
                return settings;
            }
            return null;
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function updateViewMode() {
            const viewMode = document.getElementById('viewMode').value;
            const gameCountControl = document.getElementById('gameCountControl');
            const gameSelectControls = ['gameSelectControl1', 'gameSelectControl2', 'gameSelectControl3'];
            const container = document.getElementById('statsContainer');
            
            if (viewMode === 'comparison') {
                gameCountControl.style.display = 'none';
                gameSelectControls.forEach(id => document.getElementById(id).style.display = 'none');
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
                container.className = 'stats-container';
                showComparison();
            } else {
                gameCountControl.style.display = 'flex';
                updateGameCount();
                updateStats();
            }
            
            saveInterfaceSettings();
        }

        function updateGameCount() {
            const count = parseInt(document.getElementById('gameCount').value);
            const gameSelectControls = ['gameSelectControl1', 'gameSelectControl2', 'gameSelectControl3'];
            
            gameSelectControls.forEach((id, index) => {
                document.getElementById(id).style.display = index < count ? 'flex' : 'none';
            });
            
            const container = document.getElementById('statsContainer');
            container.className = `stats-container ${count === 1 ? 'one-game' : count === 2 ? 'two-games' : 'three-games'}`;
            
            saveInterfaceSettings();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å–µ—Ä–∏–π –ø–æ–±–µ–¥/–ø–æ—Ä–∞–∂–µ–Ω–∏–π
        function calculateStreaks(pulls) {
            let currentWinStreak = 0;
            let currentLoseStreak = 0;
            let maxWinStreak = 0;
            let maxLoseStreak = 0;
            
            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –ø—É–ª–∞–º —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (–∏—Å–∫–ª—é—á–∞—è –≥–∞—Ä–∞–Ω—Ç)
            pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee').forEach(pull => {
                if (pull.eventResult === 'win') {
                    currentWinStreak++;
                    currentLoseStreak = 0;
                    maxWinStreak = Math.max(maxWinStreak, currentWinStreak);
                } else if (pull.eventResult === 'lose') {
                    currentLoseStreak++;
                    currentWinStreak = 0;
                    maxLoseStreak = Math.max(maxLoseStreak, currentLoseStreak);
                }
            });
            
            return { maxWinStreak, maxLoseStreak };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —É–¥–∞—á–∏
        function calculateLuckScore(game) {
            if (!game.banners || game.banners.length === 0) return 0;
            
            let totalScore = 0;
            let totalWeight = 0;
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const totalPulls = game.banners.reduce((sum, banner) => 
                sum + banner.pulls.reduce((bannerSum, pull) => bannerSum + pull.count, 0), 0);
            
            const totalLegendaries = game.banners.reduce((sum, banner) => sum + banner.pulls.length, 0);
            
            if (totalLegendaries === 0) return 0;
            
            const avgLegendary = totalPulls / totalLegendaries;
            
            // 1. –û—Ü–µ–Ω–∫–∞ —Å—Ä–µ–¥–Ω–µ–π –ª–µ–≥–µ–Ω–¥–∞—Ä–∫–∏ (–≤–µ—Å: 40%)
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω—é—é –ª–µ–≥–µ–Ω–¥–∞—Ä–∫—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –±–∞–Ω–Ω–µ—Ä–∞ —Å –≤–µ—Å–∞–º–∏
            let weightedAvgScore = 0;
            let totalWeightedPulls = 0;
            let totalWeightedLegendaries = 0;
            
            game.banners.forEach(banner => {
                const bannerPulls = banner.pulls.reduce((sum, pull) => sum + pull.count, 0);
                const bannerLegendaries = banner.pulls.length;
                
                if (bannerLegendaries > 0) {
                    const bannerAvg = bannerPulls / bannerLegendaries;
                    let bannerWeight = 0;
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–µ—Å –±–∞–Ω–Ω–µ—Ä–∞
                    if (banner.type === 'event') {
                        bannerWeight = 0.5; // 50% –¥–ª—è –∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ
                    } else if (banner.type === 'weapon' || banner.type === 'standard') {
                        bannerWeight = 0.25; // 25% –¥–ª—è –æ—Ä—É–∂–µ–π–Ω–æ–≥–æ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ
                    }
                    
                    // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
                    const excellentThreshold = Math.floor(banner.guarantee * 0.55);
                    const goodThreshold = Math.floor(banner.guarantee * 0.68);
                    const averageThreshold = Math.floor(banner.guarantee * 0.82);
                    
                    let bannerScore = 0;
                    if (bannerAvg <= excellentThreshold) {
                        bannerScore = 90;
                    } else if (bannerAvg <= goodThreshold) {
                        bannerScore = 70;
                    } else if (bannerAvg <= averageThreshold) {
                        bannerScore = 50;
                    } else {
                        bannerScore = 30;
                    }
                    
                    weightedAvgScore += bannerScore * bannerWeight;
                    totalWeightedPulls += bannerPulls * bannerWeight;
                    totalWeightedLegendaries += bannerLegendaries * bannerWeight;
                }
            });
            
            totalScore += weightedAvgScore * 0.4;
            totalWeight += 0.4;
            
            // 2. –û—Ü–µ–Ω–∫–∞ —Ä–∞–Ω–Ω–∏—Ö –∫—Ä—É—Ç–æ–∫ (–≤–µ—Å: 20%)
            let earlyPulls = 0;
            let totalPullsForEarly = 0;
            
            game.banners.forEach(banner => {
                banner.pulls.forEach(pull => {
                    totalPullsForEarly++;
                    const greenMax = Math.floor(banner.guarantee * 39 / 90);
                    if (pull.count <= greenMax) {
                        earlyPulls++;
                    }
                });
            });
            
            const earlyRate = totalPullsForEarly > 0 ? (earlyPulls / totalPullsForEarly) * 100 : 0;
            let earlyScore = 0;
            if (earlyRate >= 30) {
                earlyScore = 80; // –ú–Ω–æ–≥–æ —Ä–∞–Ω–Ω–∏—Ö –∫—Ä—É—Ç–æ–∫
            } else if (earlyRate >= 20) {
                earlyScore = 60;
            } else if (earlyRate >= 10) {
                earlyScore = 40;
            } else if (earlyRate >= 5) {
                earlyScore = 20;
            } else {
                earlyScore = 10;
            }
            totalScore += earlyScore * 0.2;
            totalWeight += 0.2;
            
            // 3. –û—Ü–µ–Ω–∫–∞ 50/50 (–≤–µ—Å: 30%)
            let fiftyFiftyWins = 0;
            let fiftyFiftyCount = 0;
            
            game.banners.forEach(banner => {
                if (banner.type === 'event' || banner.type === 'weapon') {
                    const relevantPulls = banner.pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee');
                    fiftyFiftyCount += relevantPulls.length;
                    
                    relevantPulls.forEach(pull => {
                        if (pull.eventResult === 'win') {
                            fiftyFiftyWins++;
                        }
                    });
                }
            });
            
            const fiftyFiftyRate = fiftyFiftyCount > 0 ? (fiftyFiftyWins / fiftyFiftyCount) * 100 : 0;
            let fiftyFiftyScore = 0;
            
            if (fiftyFiftyRate <= 33.3) {
                fiftyFiftyScore = 20; // –ü–ª–æ—Ö–æ
            } else if (fiftyFiftyRate <= 66.6) {
                fiftyFiftyScore = 40; // –ù–æ—Ä–º–∞–ª—å–Ω–æ
            } else {
                fiftyFiftyScore = 60; // –•–æ—Ä–æ—à–æ
            }
            
            totalScore += fiftyFiftyScore * 0.3;
            totalWeight += 0.3;
            
            // 4. –û—Ü–µ–Ω–∫–∞ —Å–µ—Ä–∏–π (–≤–µ—Å: 10%)
            let streakScore = 0;
            let totalStreaks = 0;
            
            game.banners.forEach(banner => {
                if (banner.type === 'event') {
                    const streaks = calculateStreaks(banner.pulls);
                    if (streaks.maxWinStreak > 0) {
                        streakScore += Math.min(streaks.maxWinStreak * 10, 100); // +10 –∑–∞ –∫–∞–∂–¥—É—é –ø–æ–±–µ–¥—É –≤ —Å–µ—Ä–∏–∏
                        totalStreaks++;
                    }
                    if (streaks.maxLoseStreak > 0) {
                        streakScore -= Math.min(streaks.maxLoseStreak * 10, 50); // -10 –∑–∞ –∫–∞–∂–¥–æ–µ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–µ—Ä–∏–∏
                        totalStreaks++;
                    }
                }
            });
            
            const finalStreakScore = totalStreaks > 0 ? Math.max(0, Math.min(100, streakScore / totalStreaks + 50)) : 50;
            totalScore += finalStreakScore * 0.1;
            totalWeight += 0.1;
            
            const finalScore = totalWeight > 0 ? Math.round(totalScore / totalWeight) : 0;
            
            return finalScore;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —É–¥–∞—á–∏
        function getLuckClass(score) {
            if (score >= 75) return 'excellent';
            if (score >= 60) return 'good';
            if (score >= 45) return 'average';
            return 'bad';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ —É–¥–∞—á–∏
        function getLuckText(score) {
            if (score >= 75) return '–û—Ç–ª–∏—á–Ω–∞—è —É–¥–∞—á–∞';
            if (score >= 60) return '–•–æ—Ä–æ—à–∞—è —É–¥–∞—á–∞';
            if (score >= 45) return '–°—Ä–µ–¥–Ω—è—è —É–¥–∞—á–∞';
            return '–ü–ª–æ—Ö–∞—è —É–¥–∞—á–∞';
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏
        function updateGameSelectors() {
            ['gameSelect1', 'gameSelect2', 'gameSelect3'].forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</option>';
                
                games.forEach(game => {
                    const option = document.createElement('option');
                    option.value = game.id;
                    option.textContent = game.name;
                    select.appendChild(option);
                });
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if (games.length > 0) {
                for (let i = 0; i < 3; i++) {
                    if (!currentGameIds[i] || !games.find(g => g.id === currentGameIds[i])) {
                        currentGameIds[i] = i < games.length ? games[i].id : null;
                    }
                    document.getElementById(`gameSelect${i + 1}`).value = currentGameIds[i] || '';
                }
            }

            updateStats();
        }

        function updateStats() {
            const viewMode = document.getElementById('viewMode').value;
            if (viewMode === 'comparison') {
                showComparison();
                return;
            }

            const count = parseInt(document.getElementById('gameCount').value);
            updateGameCount();
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö
            const selectedGames = [];
            for (let i = 0; i < count; i++) {
                const gameId = document.getElementById(`gameSelect${i + 1}`).value;
                if (gameId) {
                    const game = games.find(g => g.id === gameId);
                    if (game) selectedGames.push(game);
                }
                currentGameIds[i] = gameId || null;
            }

            saveInterfaceSettings();

            const container = document.getElementById('statsContainer');
            
            if (selectedGames.length === 0) {
                container.innerHTML = '<div class="no-games"><p>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p></div>';
                return;
            }

            container.innerHTML = selectedGames.map(game => renderGameStats(game)).join('');
        }

        function renderGameStats(game) {
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const totalPulls = game.banners.reduce((sum, banner) => 
                sum + banner.pulls.reduce((bannerSum, pull) => bannerSum + pull.count, 0), 0);
            
            const totalLegendaries = game.banners.reduce((sum, banner) => sum + banner.pulls.length, 0);
            
            const avgLegendary = totalLegendaries > 0 ? (totalPulls / totalLegendaries).toFixed(1) : 0;

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É 50/50 –¥–ª—è –∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
            const eventBanner = game.banners.find(b => b.type === 'event');
            let eventWinRate = 0;
            let eventStreaks = { maxWinStreak: 0, maxLoseStreak: 0 };
            if (eventBanner) {
                const eventPulls = eventBanner.pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee');
                const wins = eventPulls.filter(p => p.eventResult === 'win').length;
                eventWinRate = eventPulls.length > 0 ? (wins * 100 / eventPulls.length).toFixed(1) : 0;
                eventStreaks = calculateStreaks(eventBanner.pulls);
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ä—É–∂–µ–π–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
            const weaponBanner = game.banners.find(b => b.type === 'weapon');
            let weaponWinRate = 0;
            if (weaponBanner) {
                const weaponPulls = weaponBanner.pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee');
                const wins = weaponPulls.filter(p => p.eventResult === 'win').length;
                weaponWinRate = weaponPulls.length > 0 ? (wins * 100 / weaponPulls.length).toFixed(1) : 0;
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–¥–∞—á–∏
            const luckScore = calculateLuckScore(game);
            const luckClass = getLuckClass(luckScore);
            const luckText = getLuckText(luckScore);

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let earlyPulls = 0;
            let totalPullsForEarly = 0;
            game.banners.forEach(banner => {
                banner.pulls.forEach(pull => {
                    totalPullsForEarly++;
                    const greenMax = Math.floor(banner.guarantee * 39 / 90);
                    if (pull.count <= greenMax) {
                        earlyPulls++;
                    }
                });
            });
            const earlyRate = totalPullsForEarly > 0 ? (earlyPulls / totalPullsForEarly * 100).toFixed(1) : 0;

            return `
                <div class="game-stats">
                    <div class="game-title">
                        <div class="game-title-left">
                            ${game.name}
                        </div>
                        <div class="game-title-right">
                            ${totalLegendaries > 0 ? `
                                <div class="luck-score ${luckClass}">
                                    <div class="luck-score-circle">${luckScore}</div>
                                    <div class="luck-score-text">${luckText}</div>
                                </div>
                            ` : ''}
                            <div class="game-actions">
                                <button class="game-action-btn" onclick="editGame('${game.id}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–≥—Ä—É">‚úèÔ∏è</button>
                                <button class="game-action-btn delete" onclick="deleteGame('${game.id}')" title="–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É">üóëÔ∏è</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overall-stats">
                        <div class="stat-card">
                            <div class="stat-value">${totalPulls}</div>
                            <div class="stat-label">–í—Å–µ–≥–æ –∫—Ä—É—Ç–æ–∫</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalLegendaries}</div>
                            <div class="stat-label">–õ–µ–≥–µ–Ω–¥–∞—Ä–æ–∫</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${avgLegendary}</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω—è—è –ª–µ–≥–∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${eventWinRate}%</div>
                            <div class="stat-label">–ü–æ–±–µ–¥ —Å–æ–±—ã—Ç–∏–π</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${weaponWinRate}%</div>
                            <div class="stat-label">–ü–æ–±–µ–¥ –æ—Ä—É–∂–∏—è</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${eventStreaks.maxWinStreak}</div>
                            <div class="stat-label">–°–µ—Ä–∏—è –ø–æ–±–µ–¥</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${eventStreaks.maxLoseStreak}</div>
                            <div class="stat-label">–°–µ—Ä–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                        </div>
                    </div>
                    <div class="banners-container">
                        ${game.banners.map(banner => renderBanner(banner, game.id)).join('')}
                    </div>
                </div>
            `;
        }

        function renderBanner(banner, gameId) {
            const totalPulls = banner.pulls.reduce((sum, pull) => sum + pull.count, 0);
            const totalLegendaries = banner.pulls.length;
            const avgLegendary = totalLegendaries > 0 ? (totalPulls / totalLegendaries).toFixed(1) : 0;

            // –†–µ–≤–µ—Ä—Å–∏—Ä—É–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫—Ä—É—Ç–æ–∫ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const reversedPulls = [...banner.pulls].reverse();

            return `
                <div class="banner">
                    <div class="banner-title">${banner.name}</div>
                    <div class="banner-stats">
                        <div class="banner-stat">
                            <div>${totalPulls}</div>
                            <div>–ö—Ä—É—Ç–æ–∫</div>
                        </div>
                        <div class="banner-stat">
                            <div>${totalLegendaries}</div>
                            <div>–õ–µ–≥</div>
                        </div>
                        <div class="banner-stat">
                            <div>${avgLegendary}</div>
                            <div>–°—Ä–µ–¥–Ω—è—è</div>
                        </div>
                    </div>
                    <button class="add-pull-btn" onclick="openAddPullModal('${banner.type}', '${gameId}')">+ –î–æ–±–∞–≤–∏—Ç—å –∫—Ä—É—Ç–∫—É</button>
                    <div class="pulls-list">
                        ${reversedPulls.map((pull, index) => renderPull(pull, banner.guarantee, banner.pulls.length - index, gameId, banner.type, banner.pulls.length - 1 - index)).join('')}
                    </div>
                </div>
            `;
        }

        function renderPull(pull, guarantee, number, gameId, bannerType, originalIndex) {
            const countClass = getCountClass(pull.count, guarantee);
            const typeClass = pull.type === 'weapon' ? 'weapon' : 'character';
            
            let eventResultHtml = '';
            if (pull.eventResult) {
                const resultClass = pull.eventResult === 'win' ? 'win' : 
                                  pull.eventResult === 'lose' ? 'lose' : 'guarantee';
                const resultText = pull.eventResult === 'win' ? 'W' : 
                                 pull.eventResult === 'lose' ? 'L' : 'G';
                eventResultHtml = `<span class="pull-type ${resultClass}">${resultText}</span>`;
            }

            return `
                <div class="pull-item">
                    <span class="pull-number">#${number}</span>
                    <div class="pull-name ${typeClass}">
                        ${eventResultHtml}
                        <span>${pull.name}</span>
                    </div>
                    <span class="pull-count ${countClass}">${pull.count}</span>
                    <div class="pull-actions">
                        <button class="pull-action-btn" onclick="editPull('${gameId}', '${bannerType}', ${originalIndex})">‚úèÔ∏è</button>
                        <button class="pull-action-btn delete" onclick="deletePull('${gameId}', '${bannerType}', ${originalIndex})">üóëÔ∏è</button>
                    </div>
                </div>
            `;
        }

        function getCountClass(count, guarantee) {
            let greenMax, yellowMax;
            
            if (guarantee === 90) {
                greenMax = 39;
                yellowMax = 73;
            } else if (guarantee === 80) {
                greenMax = 29;
                yellowMax = 63;
            } else if (guarantee === 70) {
                greenMax = 19;
                yellowMax = 53;
            } else {
                // –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≥–∞—Ä–∞–Ω—Ç–æ–≤: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –æ—Ç –≥–∞—Ä–∞–Ω—Ç–∞ 90
                greenMax = Math.floor(guarantee * 39 / 90);
                yellowMax = Math.floor(guarantee * 73 / 90);
            }
            
            if (count <= greenMax) return 'good';
            if (count <= yellowMax) return 'average';
            return 'bad';
        }

        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏–≥—Ä
        function openAddGameModal() {
            document.getElementById('addGameModal').style.display = 'block';
            toggleSidebar();
        }

        function closeAddGameModal() {
            document.getElementById('addGameModal').style.display = 'none';
            resetGameForm();
        }

        function resetGameForm() {
            document.getElementById('gameName').value = '';
            ['standard', 'event', 'weapon'].forEach(type => {
                document.getElementById(type + 'Banner').checked = true;
                document.getElementById(type + 'Guarantee').value = type === 'weapon' ? '80' : '90';
                document.getElementById(type + 'Custom').style.display = 'none';
                document.getElementById(type + 'Custom').value = '';
            });
        }

        function addGame() {
            const name = document.getElementById('gameName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã');
                return;
            }

            const banners = [];
            let hasError = false;
            
            ['standard', 'event', 'weapon'].forEach(type => {
                if (document.getElementById(type + 'Banner').checked) {
                    const guaranteeSelect = document.getElementById(type + 'Guarantee');
                    let guarantee = parseInt(guaranteeSelect.value);
                    
                    if (guaranteeSelect.value === 'custom') {
                        guarantee = parseInt(document.getElementById(type + 'Custom').value);
                        if (!guarantee || guarantee < 1) {
                            alert(`–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∞ –¥–ª—è ${type === 'standard' ? '—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ' : type === 'event' ? '–∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ' : '–æ—Ä—É–∂–µ–π–Ω–æ–≥–æ'} –±–∞–Ω–Ω–µ—Ä–∞`);
                            hasError = true;
                            return;
                        }
                    }

                    const bannerNames = {
                        standard: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π',
                        event: '–ò–≤–µ–Ω—Ç–æ–≤—ã–π',
                        weapon: '–û—Ä—É–∂–µ–π–Ω—ã–π'
                    };

                    banners.push({
                        type: type,
                        name: bannerNames[type],
                        guarantee: guarantee,
                        pulls: []
                    });
                }
            });

            if (hasError) return;

            if (banners.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–∞–Ω–Ω–µ—Ä');
                return;
            }

            const newGame = {
                id: Date.now().toString(),
                name: name,
                banners: banners
            };

            games.push(newGame);
            currentGameIds[0] = newGame.id;
            saveData();
            updateGameSelectors();
            closeAddGameModal();
        }

        function editGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É —Ç–µ–∫—É—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            document.getElementById('gameName').value = game.name;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —á–µ–∫–±–æ–∫—Å—ã
            ['standard', 'event', 'weapon'].forEach(type => {
                document.getElementById(type + 'Banner').checked = false;
                document.getElementById(type + 'Guarantee').value = type === 'weapon' ? '80' : '90';
                document.getElementById(type + 'Custom').style.display = 'none';
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–∞–Ω–Ω–µ—Ä–æ–≤
            game.banners.forEach(banner => {
                document.getElementById(banner.type + 'Banner').checked = true;
                const guaranteeSelect = document.getElementById(banner.type + 'Guarantee');
                if ([70, 80, 90].includes(banner.guarantee)) {
                    guaranteeSelect.value = banner.guarantee.toString();
                } else {
                    guaranteeSelect.value = 'custom';
                    document.getElementById(banner.type + 'Custom').style.display = 'block';
                    document.getElementById(banner.type + 'Custom').value = banner.guarantee;
                }
            });

            openAddGameModal();
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            const addBtn = document.querySelector('#addGameModal .btn-primary');
            addBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            addBtn.onclick = function() { updateGame(gameId); };
        }

        function deleteGame(gameId) {
            const game = games.find(g => g.id === gameId);
            if (!game) return;

            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É "${game.name}"? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã.`)) {
                games = games.filter(g => g.id !== gameId);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–≥—Ä—ã
                currentGameIds = currentGameIds.map(id => id === gameId ? null : id);
                
                saveData();
                updateGameSelectors();
            }
        }

        function updateGame(gameId) {
            const name = document.getElementById('gameName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã');
                return;
            }

            const game = games.find(g => g.id === gameId);
            if (!game) return;

            const newBanners = [];
            let hasError = false;
            
            ['standard', 'event', 'weapon'].forEach(type => {
                if (document.getElementById(type + 'Banner').checked) {
                    const guaranteeSelect = document.getElementById(type + 'Guarantee');
                    let guarantee = parseInt(guaranteeSelect.value);
                    
                    if (guaranteeSelect.value === 'custom') {
                        guarantee = parseInt(document.getElementById(type + 'Custom').value);
                        if (!guarantee || guarantee < 1) {
                            alert(`–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∞ –¥–ª—è ${type === 'standard' ? '—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ' : type === 'event' ? '–∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ' : '–æ—Ä—É–∂–µ–π–Ω–æ–≥–æ'} –±–∞–Ω–Ω–µ—Ä–∞`);
                            hasError = true;
                            return;
                        }
                    }

                    const existing = game.banners.find(b => b.type === type);
                    const bannerNames = {
                        standard: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π',
                        event: '–ò–≤–µ–Ω—Ç–æ–≤—ã–π',
                        weapon: '–û—Ä—É–∂–µ–π–Ω—ã–π'
                    };

                    newBanners.push({
                        type: type,
                        name: bannerNames[type],
                        guarantee: guarantee,
                        pulls: existing ? existing.pulls : []
                    });
                }
            });

            if (hasError) return;

            game.name = name;
            game.banners = newBanners;

            saveData();
            updateGameSelectors();
            closeAddGameModal();
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            const addBtn = document.querySelector('#addGameModal .btn-primary');
            addBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å';
            addBtn.onclick = function() { addGame(); };
        }

        function clearAllData() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–≥—Ä? –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä –æ—Å—Ç–∞–Ω—É—Ç—Å—è, –Ω–æ –≤—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞.')) {
                games.forEach(game => {
                    game.banners.forEach(banner => {
                        banner.pulls = [];
                    });
                });
                saveData();
                updateStats();
                toggleSidebar();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—Ä—É—Ç–æ–∫
        function openAddPullModal(bannerType, gameId) {
            currentBannerType = bannerType;
            currentGameIds[0] = gameId;
            editingPullIndex = -1;
            
            const modal = document.getElementById('addPullModal');
            const title = document.getElementById('addPullTitle');
            const typeGroup = document.getElementById('pullTypeGroup');
            const eventGroup = document.getElementById('eventResultGroup');
            
            const game = games.find(g => g.id === gameId);
            const banner = game.banners.find(b => b.type === bannerType);
            
            title.textContent = `–î–æ–±–∞–≤–∏—Ç—å –∫—Ä—É—Ç–∫—É - ${banner.name}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –±–∞–Ω–Ω–µ—Ä–∞
            if (bannerType === 'standard') {
                typeGroup.style.display = 'block';
                eventGroup.style.display = 'none';
            } else {
                typeGroup.style.display = 'none';
                eventGroup.style.display = 'block'; // –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–ª—è –≤—Å–µ—Ö –Ω–µ-—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∞–Ω–Ω–µ—Ä–æ–≤
            }
            
            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            document.getElementById('pullName').value = '';
            document.getElementById('pullCount').value = '';
            document.getElementById('pullType').value = 'character';
            document.getElementById('eventResult').value = 'win';
            
            modal.style.display = 'block';
        }

        function editPull(gameId, bannerType, pullIndex) {
            const game = games.find(g => g.id === gameId);
            const banner = game.banners.find(b => b.type === bannerType);
            const pull = banner.pulls[pullIndex];
            
            currentBannerType = bannerType;
            currentGameIds[0] = gameId;
            editingPullIndex = pullIndex;
            
            const modal = document.getElementById('addPullModal');
            const title = document.getElementById('addPullTitle');
            const typeGroup = document.getElementById('pullTypeGroup');
            const eventGroup = document.getElementById('eventResultGroup');
            
            title.textContent = `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫—Ä—É—Ç–∫—É - ${banner.name}`;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ –∫—Ä—É—Ç–∫–∏
            document.getElementById('pullName').value = pull.name;
            document.getElementById('pullCount').value = pull.count;
            document.getElementById('pullType').value = pull.type || 'character';
            document.getElementById('eventResult').value = pull.eventResult || 'win';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è
            if (bannerType === 'standard') {
                typeGroup.style.display = 'block';
                eventGroup.style.display = 'none';
            } else {
                typeGroup.style.display = 'none';
                eventGroup.style.display = 'block';
            }
            
            modal.style.display = 'block';
        }

        function deletePull(gameId, bannerType, pullIndex) {
            const game = games.find(g => g.id === gameId);
            const banner = game.banners.find(b => b.type === bannerType);
            const pull = banner.pulls[pullIndex];
            
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –∫—Ä—É—Ç–∫—É "${pull.name}" (${pull.count} –∫—Ä—É—Ç–æ–∫)?`)) {
                banner.pulls.splice(pullIndex, 1);
                saveData();
                updateStats();
            }
        }

        function closeAddPullModal() {
            document.getElementById('addPullModal').style.display = 'none';
        }

        function savePull() {
            const name = document.getElementById('pullName').value.trim();
            const count = parseInt(document.getElementById('pullCount').value);
            
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞/–æ—Ä—É–∂–∏—è');
                return;
            }
            
            if (!count || count < 1) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä—É—Ç–æ–∫');
                return;
            }

            const game = games.find(g => g.id === currentGameIds[0]);
            const banner = game.banners.find(b => b.type === currentBannerType);
            
            const pull = {
                name: name,
                count: count
            };

            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
            if (currentBannerType === 'standard') {
                pull.type = document.getElementById('pullType').value;
            } else {
                pull.type = currentBannerType === 'weapon' ? 'weapon' : 'character';
            }

            // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ –∏ –æ—Ä—É–∂–µ–π–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–æ–≤
            if (currentBannerType === 'event' || currentBannerType === 'weapon') {
                pull.eventResult = document.getElementById('eventResult').value;
            }

            if (editingPullIndex >= 0) {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫—Ä—É—Ç–∫–∏
                banner.pulls[editingPullIndex] = pull;
            } else {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫—Ä—É—Ç–∫–∏
                banner.pulls.push(pull);
            }

            saveData();
            updateStats();
            closeAddPullModal();
        }

        // –ò–º–ø–æ—Ä—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const dataStr = JSON.stringify(games, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `gacha_stats_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            toggleSidebar();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–º–µ–Ω–µ–Ω—ã.')) {
                        games = importedData;
                        currentGameIds = [null, null, null];
                        saveData();
                        updateGameSelectors();
                    }
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.');
                }
            };
            reader.readAsText(file);
            
            // –°–±—Ä–æ—Å input —Ñ–∞–π–ª–∞
            event.target.value = '';
            toggleSidebar();
        }

        // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä
        function showComparison() {
            const container = document.getElementById('statsContainer');
            
            if (games.length === 0) {
                container.innerHTML = '<div class="no-games"><p>–ù–µ—Ç –∏–≥—Ä –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è</p></div>';
                return;
            }

            const gameStats = games.map(game => {
                const totalPulls = game.banners.reduce((sum, banner) => 
                    sum + banner.pulls.reduce((bannerSum, pull) => bannerSum + pull.count, 0), 0);
                
                const totalLegendaries = game.banners.reduce((sum, banner) => sum + banner.pulls.length, 0);
                
                const avgLegendary = totalLegendaries > 0 ? totalPulls / totalLegendaries : 0;

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–≤–µ–Ω—Ç–æ–≤–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
                const eventBanner = game.banners.find(b => b.type === 'event');
                let eventWinRate = 0;
                let eventStreaks = { maxWinStreak: 0, maxLoseStreak: 0 };
                if (eventBanner) {
                    const eventPulls = eventBanner.pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee');
                    const wins = eventPulls.filter(p => p.eventResult === 'win').length;
                    eventWinRate = eventPulls.length > 0 ? wins / eventPulls.length * 100 : 0;
                    eventStreaks = calculateStreaks(eventBanner.pulls);
                }

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ä—É–∂–µ–π–Ω–æ–≥–æ –±–∞–Ω–Ω–µ—Ä–∞
				const weaponBanner = game.banners.find(b => b.type === 'weapon');
				let weaponWinRate = 0;
				if (weaponBanner) {
					const weaponPulls = weaponBanner.pulls.filter(p => p.eventResult && p.eventResult !== 'guarantee');
					const wins = weaponPulls.filter(p => p.eventResult === 'win').length;
					weaponWinRate = weaponPulls.length > 0 ? wins / weaponPulls.length * 100 : 0;
				}

				// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç —Ä–∞–Ω–Ω–∏—Ö –ª–µ–≥–µ–Ω–¥–∞—Ä–æ–∫
				let earlyPulls = 0;
				let totalPullsForEarly = 0;
				game.banners.forEach(banner => {
					banner.pulls.forEach(pull => {
						totalPullsForEarly++;
						const greenMax = Math.floor(banner.guarantee * 39 / 90);
						if (pull.count <= greenMax) {
							earlyPulls++;
						}
					});
				});
				const earlyRate = totalPullsForEarly > 0 ? (earlyPulls / totalPullsForEarly * 100).toFixed(1) : 0;

				// –ù–∞—Ö–æ–¥–∏–º —Å–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π –∏ —Å–∞–º—ã–π –ø–æ–∑–¥–Ω–∏–π –ø—É–ª
				let earliestPull = null;
				let latestPull = null;
				game.banners.forEach(banner => {
					banner.pulls.forEach(pull => {
						if (!earliestPull || pull.count < earliestPull.count) {
							earliestPull = pull;
						}
						if (!latestPull || pull.count > latestPull.count) {
							latestPull = pull;
						}
					});
				});

				return {
					name: game.name,
					totalPulls,
					totalLegendaries,
					avgLegendary,
					eventWinRate,
					weaponWinRate,
					maxWinStreak: eventStreaks.maxWinStreak,
					maxLoseStreak: eventStreaks.maxLoseStreak,
					luckScore: calculateLuckScore(game),
					earlyRate: parseFloat(earlyRate),
					earliestPull: earliestPull ? earliestPull.count : 0,
					latestPull: latestPull ? latestPull.count : 0
				};
            });

            // –ù–∞—Ö–æ–¥–∏–º –ª—É—á—à–∏–µ –∏ —Ö—É–¥—à–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–∏—Å–∫–ª—é—á–∞—è –Ω—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≥–¥–µ —ç—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª)
            const validLegendaries = gameStats.filter(g => g.totalLegendaries > 0);
            const validAvg = gameStats.filter(g => g.avgLegendary > 0);
            const validEventWinRate = gameStats.filter(g => g.eventWinRate > 0);
            const validWeaponWinRate = gameStats.filter(g => g.weaponWinRate > 0);
            const validWinStreak = gameStats.filter(g => g.maxWinStreak > 0);
            const validLoseStreak = gameStats.filter(g => g.maxLoseStreak > 0);

            const bestLegendaries = validLegendaries.length > 0 ? Math.max(...validLegendaries.map(g => g.totalLegendaries)) : 0;
            const worstLegendaries = validLegendaries.length > 0 ? Math.min(...validLegendaries.map(g => g.totalLegendaries)) : 0;
            const bestAvg = validAvg.length > 0 ? Math.min(...validAvg.map(g => g.avgLegendary)) : 0;
            const worstAvg = validAvg.length > 0 ? Math.max(...validAvg.map(g => g.avgLegendary)) : 0;
            const bestEventWinRate = validEventWinRate.length > 0 ? Math.max(...validEventWinRate.map(g => g.eventWinRate)) : 0;
            const worstEventWinRate = validEventWinRate.length > 0 ? Math.min(...validEventWinRate.map(g => g.eventWinRate)) : 0;
            const bestWeaponWinRate = validWeaponWinRate.length > 0 ? Math.max(...validWeaponWinRate.map(g => g.weaponWinRate)) : 0;
            const worstWeaponWinRate = validWeaponWinRate.length > 0 ? Math.min(...validWeaponWinRate.map(g => g.weaponWinRate)) : 0;
            const bestWinStreak = validWinStreak.length > 0 ? Math.max(...validWinStreak.map(g => g.maxWinStreak)) : 0;
            const worstWinStreak = validWinStreak.length > 0 ? Math.min(...validWinStreak.map(g => g.maxWinStreak)) : 0;
            const bestLoseStreak = validLoseStreak.length > 0 ? Math.min(...validLoseStreak.map(g => g.maxLoseStreak)) : 0; // –ú–∏–Ω–∏–º—É–º –ª—É—á—à–µ –¥–ª—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π
            const worstLoseStreak = validLoseStreak.length > 0 ? Math.max(...validLoseStreak.map(g => g.maxLoseStreak)) : 0;
            
            // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–¥–∞—á–∏
            const validLuckScores = gameStats.filter(g => g.luckScore > 0);
            const bestLuckScore = validLuckScores.length > 0 ? Math.max(...validLuckScores.map(g => g.luckScore)) : 0;
            const worstLuckScore = validLuckScores.length > 0 ? Math.min(...validLuckScores.map(g => g.luckScore)) : 0;
            
            // –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–∞–Ω–Ω–∏—Ö –ª–µ–≥–µ–Ω–¥–∞—Ä–æ–∫
            const validEarlyRates = gameStats.filter(g => g.earlyRate > 0);
            const bestEarlyRate = validEarlyRates.length > 0 ? Math.max(...validEarlyRates.map(g => g.earlyRate)) : 0;
            const worstEarlyRate = validEarlyRates.length > 0 ? Math.min(...validEarlyRates.map(g => g.earlyRate)) : 0;
            
            // –°–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π –∏ —Å–∞–º—ã–π –ø–æ–∑–¥–Ω–∏–π –ø—É–ª
            const validEarliestPulls = gameStats.filter(g => g.earliestPull > 0);
            const bestEarliestPull = validEarliestPulls.length > 0 ? Math.min(...validEarliestPulls.map(g => g.earliestPull)) : 0; // –ú–∏–Ω–∏–º—É–º –ª—É—á—à–µ –¥–ª—è —Ä–∞–Ω–Ω–∏—Ö
            const worstEarliestPull = validEarliestPulls.length > 0 ? Math.max(...validEarliestPulls.map(g => g.earliestPull)) : 0;
            
            const validLatestPulls = gameStats.filter(g => g.latestPull > 0);
            const bestLatestPull = validLatestPulls.length > 0 ? Math.min(...validLatestPulls.map(g => g.latestPull)) : 0; // –ú–∏–Ω–∏–º—É–º –ª—É—á—à–µ –¥–ª—è –ø–æ–∑–¥–Ω–∏—Ö
            const worstLatestPull = validLatestPulls.length > 0 ? Math.max(...validLatestPulls.map(g => g.latestPull)) : 0;

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä –¥–ª—è CSS –∫–ª–∞—Å—Å–æ–≤
            const gameCount = gameStats.length;
            const gridClass = gameCount === 1 ? 'one-game' : gameCount === 2 ? 'two-games' : 'three-games';

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ —É–¥–∞—á–∏
            function getLuckClass(score) {
                return score >= 75 ? 'excellent' : score >= 60 ? 'good' : score >= 45 ? 'average' : 'bad';
            }

            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —É–¥–∞—á–∏
            function getLuckText(score) {
                return score >= 75 ? '–û—Ç–ª–∏—á–Ω–∞—è —É–¥–∞—á–∞' : score >= 60 ? '–•–æ—Ä–æ—à–∞—è —É–¥–∞—á–∞' : score >= 45 ? '–°—Ä–µ–¥–Ω—è—è —É–¥–∞—á–∞' : '–ü–ª–æ—Ö–∞—è —É–¥–∞—á–∞';
            }

            const comparisonHtml = `
                <div class="comparison-view">
                    <div class="comparison-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–≥—Ä</div>
                    <div class="comparison-games ${gridClass}">
                        ${gameStats.map(stat => `
                            <div class="comparison-game">
                                <div class="comparison-game-title">
                                    ${stat.name}
                                </div>
                                
                                ${stat.luckScore > 0 ? `
                                    <div class="comparison-luck-score ${getLuckClass(stat.luckScore)}">
                                        <div class="comparison-luck-circle">${stat.luckScore}</div>
                                        <div class="comparison-luck-text">${getLuckText(stat.luckScore)}</div>
                                    </div>
                                ` : ''}
                                
                                <div class="comparison-overall-stats">
                                    <div class="comparison-stat-card ${stat.totalLegendaries === bestLegendaries && bestLegendaries > 0 ? 'best' : stat.totalLegendaries === worstLegendaries && worstLegendaries > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.totalLegendaries}</div>
                                        <div class="comparison-stat-label">–õ–µ–≥–µ–Ω–¥–∞—Ä–æ–∫</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.avgLegendary === bestAvg && bestAvg > 0 ? 'best' : stat.avgLegendary === worstAvg && worstAvg > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.avgLegendary > 0 ? stat.avgLegendary.toFixed(1) : '-'}</div>
                                        <div class="comparison-stat-label">–°—Ä–µ–¥–Ω—è—è –ª–µ–≥–∞</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.eventWinRate === bestEventWinRate && bestEventWinRate > 0 ? 'best' : stat.eventWinRate === worstEventWinRate && worstEventWinRate > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.eventWinRate > 0 ? stat.eventWinRate.toFixed(1) + '%' : '-'}</div>
                                        <div class="comparison-stat-label">–ü–æ–±–µ–¥ —Å–æ–±—ã—Ç–∏–π</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.weaponWinRate === bestWeaponWinRate && bestWeaponWinRate > 0 ? 'best' : stat.weaponWinRate === worstWeaponWinRate && worstWeaponWinRate > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.weaponWinRate > 0 ? stat.weaponWinRate.toFixed(1) + '%' : '-'}</div>
                                        <div class="comparison-stat-label">–ü–æ–±–µ–¥ –æ—Ä—É–∂–∏—è</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.earlyRate === bestEarlyRate && bestEarlyRate > 0 ? 'best' : stat.earlyRate === worstEarlyRate && worstEarlyRate > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.earlyRate > 0 ? stat.earlyRate + '%' : '-'}</div>
                                        <div class="comparison-stat-label">–†–∞–Ω–Ω–∏–µ –ª–µ–≥–∏</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.maxWinStreak === bestWinStreak && bestWinStreak > 0 ? 'best' : stat.maxWinStreak === worstWinStreak && worstWinStreak > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.maxWinStreak > 0 ? stat.maxWinStreak : '-'}</div>
                                        <div class="comparison-stat-label">–°–µ—Ä–∏—è –ø–æ–±–µ–¥</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.maxLoseStreak === bestLoseStreak && bestLoseStreak > 0 ? 'best' : stat.maxLoseStreak === worstLoseStreak && worstLoseStreak > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.maxLoseStreak > 0 ? stat.maxLoseStreak : '-'}</div>
                                        <div class="comparison-stat-label">–°–µ—Ä–∏—è –ø–æ—Ä–∞–∂–µ–Ω–∏–π</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.earliestPull === bestEarliestPull && bestEarliestPull > 0 ? 'best' : stat.earliestPull === worstEarliestPull && worstEarliestPull > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.earliestPull > 0 ? stat.earliestPull : '-'}</div>
                                        <div class="comparison-stat-label">–°–∞–º—ã–π —Ä–∞–Ω–Ω–∏–π</div>
                                    </div>
                                    
                                    <div class="comparison-stat-card ${stat.latestPull === bestLatestPull && bestLatestPull > 0 ? 'best' : stat.latestPull === worstLatestPull && worstLatestPull > 0 ? 'worst' : ''}">
                                        <div class="comparison-stat-value">${stat.latestPull > 0 ? stat.latestPull : '-'}</div>
                                        <div class="comparison-stat-label">–°–∞–º—ã–π –ø–æ–∑–¥–Ω–∏–π</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="comparison-summary">
                        <div class="comparison-summary-title">üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                        <div class="comparison-summary-stats">
                            <div class="comparison-summary-stat">
                                <div class="comparison-summary-value">${gameStats.length}</div>
                                <div class="comparison-summary-label">–ò–≥—Ä –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏</div>
                            </div>
                            <div class="comparison-summary-stat">
                                <div class="comparison-summary-value">${gameStats.reduce((sum, g) => sum + g.totalLegendaries, 0)}</div>
                                <div class="comparison-summary-label">–í—Å–µ–≥–æ –ª–µ–≥–µ–Ω–¥–∞—Ä–æ–∫</div>
                            </div>
                            <div class="comparison-summary-stat">
                                <div class="comparison-summary-value">${gameStats.reduce((sum, g) => sum + g.totalPulls, 0)}</div>
                                <div class="comparison-summary-label">–í—Å–µ–≥–æ –∫—Ä—É—Ç–æ–∫</div>
                            </div>
                            <div class="comparison-summary-stat">
                                <div class="comparison-summary-value">${(gameStats.reduce((sum, g) => sum + g.luckScore, 0) / gameStats.filter(g => g.luckScore > 0).length).toFixed(1)}</div>
                                <div class="comparison-summary-label">–°—Ä–µ–¥–Ω–∏–π –∫–æ—ç—Ñ. —É–¥–∞—á–∏</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = comparisonHtml;
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
                
                const sidebar = document.getElementById('sidebar');
                if (sidebar.classList.contains('open')) {
                    toggleSidebar();
                }
            }
        });

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
        setInterval(saveData, 30000); // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
		
		// –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker –¥–ª—è PWA
		async function registerServiceWorker() {
			if ('serviceWorker' in navigator) {
				try {
					const registration = await navigator.serviceWorker.register('./sw.js');
					console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration);
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', error);
				}
			}
		}
    </script>
</body>
</html>
